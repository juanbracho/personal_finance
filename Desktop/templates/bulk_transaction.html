{% extends "base.html" %}

{% block title %}Bulk Transaction — Kanso{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/bulk_transactions.js') }}"></script>
{% endblock %}

{% block content %}
<div class="kanso-page-wide">

    <!-- Page Header -->
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:24px;">
        <div>
            <div class="kanso-section-label" style="margin-bottom:4px;">Transactions</div>
            <h1 style="font-size:22px; font-weight:700; color:var(--text); margin:0;">Bulk Transaction</h1>
        </div>
        <a href="{{ url_for('transactions.list_transactions') }}" class="btn-kanso btn-kanso-ghost">
            ← Back to Transactions
        </a>
    </div>

    <div class="row g-4">

        <!-- ── Main form column ── -->
        <div class="col-lg-10">
            <form method="POST" id="bulkTransactionForm">
                <input type="hidden" id="transactionItems" name="transaction_items" value="[]">

                <!-- Common Fields -->
                <div class="kanso-card" style="margin-bottom:16px; padding:20px 22px;">
                    <div class="kanso-form-section">Common Fields — Applied to All Transactions</div>

                    <!-- 3-col: Category | Sub-category | Type -->
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px 20px; margin-bottom:16px;">
                        <div>
                            <label class="kanso-form-label" for="category">Category <span style="color:var(--danger)">*</span></label>
                            <select class="kanso-select" id="category" name="category" required>
                                <option value="">Select category…</option>
                                {% for category in categories %}
                                <option value="{{ category }}">{{ category }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label class="kanso-form-label" for="sub_category">Sub-Category</label>
                            <select class="kanso-select" id="sub_category" name="sub_category">
                                <option value="">Select sub-category…</option>
                                {% for sub_category in sub_categories %}
                                <option value="{{ sub_category }}">{{ sub_category }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label class="kanso-form-label" for="type">Type <span style="color:var(--danger)">*</span></label>
                            <select class="kanso-select" id="type" name="type" required>
                                <option value="">Select type…</option>
                                {% for t in types %}
                                <option value="{{ t }}">{{ t }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- 2-col: Account | Owner -->
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px 20px;">
                        <div>
                            <label class="kanso-form-label" for="account_name">Account <span style="color:var(--danger)">*</span></label>
                            <select class="kanso-select" id="account_name" name="account_name" required>
                                <option value="">Select account…</option>
                                {% for account in accounts %}
                                <option value="{{ account }}">{{ account }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label class="kanso-form-label" for="owner">Owner <span style="color:var(--danger)">*</span></label>
                            <select class="kanso-select" id="owner" name="owner" required>
                                <option value="">Select owner…</option>
                                {% for owner in owners %}
                                <option value="{{ owner }}">{{ owner }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Transaction Items -->
                <div class="kanso-card" style="margin-bottom:16px; padding:0; overflow:hidden;">

                    <!-- Card header -->
                    <div style="display:flex; align-items:center; justify-content:space-between; padding:14px 18px; border-bottom:1px solid var(--border-subtle);">
                        <span style="font-size:13px; font-weight:600; color:var(--text);">Transaction Items</span>
                        <button type="button" class="btn-kanso btn-kanso-primary btn-kanso-sm" onclick="addRow()">
                            + Add Row
                        </button>
                    </div>

                    <div style="padding:16px 18px;">
                        <!-- Column header labels -->
                        <div style="display:flex; gap:10px; padding-bottom:8px; font-size:11px; font-weight:600; color:var(--text-faint); text-transform:uppercase; letter-spacing:0.5px; border-bottom:1px solid var(--border-subtle); margin-bottom:4px;">
                            <div style="flex:0 0 160px;">Date</div>
                            <div style="flex:1;">Description</div>
                            <div style="flex:0 0 160px;">Amount</div>
                            <div style="flex:0 0 36px;"></div>
                        </div>

                        <!-- Rows container (JS appends divs here) -->
                        <div id="itemsTableBody"></div>

                        <!-- Empty state -->
                        <div id="emptyMessage" style="text-align:center; padding:24px 0; font-size:13.5px; color:var(--text-faint);">
                            No items added yet. Click "Add Row" to start.
                        </div>

                        <!-- Summary strip -->
                        <div id="summarySection" style="display:none; margin-top:12px;">
                            <div style="padding:12px 16px; background:var(--surface-raised); border-radius:10px; border:1px solid var(--border-subtle); display:flex; justify-content:space-between; align-items:center;">
                                <span style="font-size:13px; color:var(--text-muted);">
                                    Items: <strong id="itemCount" style="color:var(--text);">0</strong>
                                </span>
                                <span style="font-size:13px; color:var(--text-muted);">
                                    Total: <strong id="totalAmount" style="color:var(--text);">$0.00</strong>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <a href="{{ url_for('transactions.list_transactions') }}" class="btn-kanso btn-kanso-ghost">
                        Cancel
                    </a>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <button type="button" class="btn-kanso btn-kanso-ghost" onclick="resetForm()">
                            Reset
                        </button>
                        <button type="submit" class="btn-kanso btn-kanso-primary" id="submitBtn" disabled>
                            Save All Transactions
                        </button>
                    </div>
                </div>

            </form>
        </div>

        <!-- ── Tips sidebar ── -->
        <div class="col-lg-2">
            <div class="kanso-card" style="padding:18px 20px;">
                <div class="kanso-form-section" style="margin-bottom:12px;">Tips</div>
                <ul style="margin:0; padding-left:16px; font-size:12.5px; color:var(--text-muted); line-height:2;">
                    <li>Common fields apply to ALL items</li>
                    <li><span style="color:var(--danger);">Positive</span> = Expense</li>
                    <li><span style="color:var(--success);">Negative</span> = Income</li>
                    <li>Each row needs date, description &amp; amount</li>
                </ul>
            </div>
        </div>

    </div><!-- /row -->
</div><!-- /kanso-page-wide -->
{% endblock %}
