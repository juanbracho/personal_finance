{% extends "base.html" %}
{% block title %}Admin Panel — Kanso{% endblock %}

{% block content %}
<div class="kanso-page">

    <!-- Page header -->
    <div class="kanso-page-header">
        <h1 class="kanso-page-title">Admin Panel</h1>
        <p class="kanso-page-subtitle">User management and system administration</p>
    </div>

    <!-- ── Users table ── -->
    <div class="kanso-section">
        <div class="kanso-section-label" style="display:flex; justify-content:space-between; align-items:center;">
            <span>Users</span>
            <a href="{{ url_for('admin.audit_logs') }}" class="btn-kanso btn-kanso-ghost btn-kanso-sm">
                <i class="fas fa-list-alt" style="font-size:11px;"></i> Audit Logs
            </a>
        </div>
        <div class="kanso-card" style="padding:0; overflow:hidden;">
            <table class="kanso-table" style="margin:0;">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th style="text-align:right;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td style="font-weight:600;">{{ user.username }}</td>
                        <td style="color:var(--text-muted);">{{ user.email or '—' }}</td>
                        <td>
                            {% if user.role == 'admin' %}
                            <span style="font-size:11px; background:var(--primary-dim,rgba(196,154,94,0.15)); color:var(--primary); padding:2px 8px; border-radius:99px; font-weight:600;">admin</span>
                            {% else %}
                            <span style="font-size:11px; color:var(--text-muted);">member</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if user.is_active %}
                            <span class="status-dot green"></span>Active
                            {% else %}
                            <span class="status-dot red"></span><span style="color:var(--text-muted);">Inactive</span>
                            {% endif %}
                        </td>
                        <td style="color:var(--text-muted); font-size:12.5px;">
                            {{ user.created_at.strftime('%b %-d, %Y') if user.created_at else '—' }}
                        </td>
                        <td style="text-align:right;">
                            {% if user.is_active %}
                            <form action="{{ url_for('admin.deactivate_user', user_id=user.id) }}" method="POST" style="display:inline;">
                                <button type="submit"
                                        class="btn-kanso btn-kanso-danger btn-kanso-sm"
                                        onclick="return confirm('Deactivate {{ user.username }}? They will be unable to log in.')">
                                    Deactivate
                                </button>
                            </form>
                            {% else %}
                            <form action="{{ url_for('admin.activate_user', user_id=user.id) }}" method="POST" style="display:inline;">
                                <button type="submit" class="btn-kanso btn-kanso-ghost btn-kanso-sm">
                                    Activate
                                </button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" style="text-align:center; color:var(--text-faint); padding:24px;">
                            No users found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ── Create user form ── -->
    <div class="kanso-section">
        <div class="kanso-section-label">Create New User</div>
        <div class="kanso-card">
            <form action="{{ url_for('admin.create_user') }}" method="POST">
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr auto; gap:12px; align-items:end; flex-wrap:wrap;">

                    <div>
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">
                            Username <span style="color:var(--danger);">*</span>
                        </label>
                        <input type="text"
                               name="username"
                               class="kanso-input"
                               placeholder="e.g. alice"
                               required
                               autocomplete="off"
                               style="width:100%;">
                    </div>

                    <div>
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">
                            Password <span style="color:var(--danger);">*</span>
                        </label>
                        <input type="password"
                               name="password"
                               class="kanso-input"
                               placeholder="••••••••"
                               required
                               autocomplete="new-password"
                               style="width:100%;">
                    </div>

                    <div>
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">
                            Email <span style="color:var(--text-faint);">(optional)</span>
                        </label>
                        <input type="email"
                               name="email"
                               class="kanso-input"
                               placeholder="alice@example.com"
                               autocomplete="off"
                               style="width:100%;">
                    </div>

                    <div>
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">
                            Role
                        </label>
                        <select name="role" class="kanso-input" style="width:100%;">
                            <option value="member">Member</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>

                </div>
                <div style="margin-top:14px;">
                    <button type="submit" class="btn-kanso btn-kanso-primary">
                        <i class="fas fa-user-plus" style="font-size:11px;"></i> Create User
                    </button>
                </div>
            </form>
        </div>
    </div>

</div><!-- /kanso-page -->
{% endblock %}
