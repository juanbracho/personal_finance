{% extends "base.html" %}

{% block title %}Add Transaction — Kanso{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/transactions.js') }}"></script>
{% endblock %}

{% block content %}
<div class="kanso-page-wide">

    <!-- Page Header -->
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:24px;">
        <div>
            <div class="kanso-section-label" style="margin-bottom:4px;">Transactions</div>
            <h1 style="font-size:22px; font-weight:700; color:var(--text); margin:0;">Add Transaction</h1>
        </div>
        <a href="{{ url_for('transactions.list_transactions') }}" class="btn-kanso btn-kanso-ghost">
            ← Back to Transactions
        </a>
    </div>

    <div class="row g-4">

        <!-- ── Form column ── -->
        <div class="col-md-8">
            <form method="POST" id="transactionForm">
                <input type="hidden" id="saveAndAddAnother" name="save_and_add_another" value="false">

                <!-- Transaction Information -->
                <div class="kanso-card" style="margin-bottom:16px; padding:20px 22px;">
                    <div class="kanso-form-section">Transaction Information</div>
                    <div class="kanso-form-grid">

                        <div>
                            <label class="kanso-form-label" for="date">Date <span style="color:var(--danger)">*</span></label>
                            <input type="date"
                                   class="kanso-input"
                                   id="date"
                                   name="date"
                                   required>
                        </div>

                        <div>
                            <label class="kanso-form-label" for="amount">Amount <span style="color:var(--danger)">*</span></label>
                            <div class="kanso-input-group">
                                <span class="kanso-input-affix prefix">$</span>
                                <input type="number"
                                       class="kanso-input has-prefix"
                                       id="amount"
                                       name="amount"
                                       step="0.01"
                                       required
                                       placeholder="0.00">
                            </div>
                            <div class="kanso-form-hint">Positive = expense &nbsp;·&nbsp; Negative = income / refund</div>
                        </div>

                        <div class="span-2">
                            <label class="kanso-form-label" for="description">Description <span style="color:var(--danger)">*</span></label>
                            <input type="text"
                                   class="kanso-input"
                                   id="description"
                                   name="description"
                                   required
                                   placeholder="e.g., Groceries at Walmart, Netflix subscription…">
                            <div class="kanso-form-hint">Brief description of the transaction</div>
                        </div>

                    </div>
                </div>

                <!-- Categorization -->
                <div class="kanso-card" style="margin-bottom:16px; padding:20px 22px;">
                    <div class="kanso-form-section">Categorization</div>
                    <div class="kanso-form-grid">

                        <div>
                            <label class="kanso-form-label" for="category">Category <span style="color:var(--danger)">*</span></label>
                            <select class="kanso-select" id="category" name="category" required>
                                <option value="">Select category…</option>
                                {% for category in categories %}
                                <option value="{{ category }}">{{ category }}</option>
                                {% endfor %}
                            </select>
                            <div class="kanso-form-hint">
                                <button type="button"
                                        class="btn-kanso btn-kanso-ghost btn-kanso-sm"
                                        data-action="add-category"
                                        style="margin-top:4px; font-size:12px; padding:3px 9px;">
                                    + Add new category
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="kanso-form-label" for="sub_category">Sub-Category</label>
                            <select class="kanso-select" id="sub_category" name="sub_category">
                                <option value="">Select sub-category…</option>
                                {% for sub_category in sub_categories %}
                                <option value="{{ sub_category }}">{{ sub_category }}</option>
                                {% endfor %}
                            </select>
                            <div class="kanso-form-hint">
                                <button type="button"
                                        class="btn-kanso btn-kanso-ghost btn-kanso-sm"
                                        data-action="add-subcategory"
                                        style="margin-top:4px; font-size:12px; padding:3px 9px;">
                                    + Add new sub-category
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="kanso-form-label" for="type">Type <span style="color:var(--danger)">*</span></label>
                            <select class="kanso-select" id="type" name="type" required>
                                <option value="">Select type…</option>
                                {% for t in types %}
                                <option value="{{ t }}">{{ t }}</option>
                                {% endfor %}
                            </select>
                            <div class="kanso-form-hint">
                                <button type="button"
                                        class="btn-kanso btn-kanso-ghost btn-kanso-sm"
                                        data-action="add-type"
                                        style="margin-top:4px; font-size:12px; padding:3px 9px;">
                                    + Add new type
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Account & Owner -->
                <div class="kanso-card" style="margin-bottom:16px; padding:20px 22px;">
                    <div class="kanso-form-section">Account &amp; Owner</div>
                    <div class="kanso-form-grid">

                        <div>
                            <label class="kanso-form-label" for="account_name">Account <span style="color:var(--danger)">*</span></label>
                            <select class="kanso-select" id="account_name" name="account_name" required>
                                <option value="">Select account…</option>
                                {% for account in accounts %}
                                <option value="{{ account }}">{{ account }}</option>
                                {% endfor %}
                            </select>
                            <div class="kanso-form-hint">
                                <button type="button"
                                        class="btn-kanso btn-kanso-ghost btn-kanso-sm"
                                        data-action="add-account"
                                        style="margin-top:4px; font-size:12px; padding:3px 9px;">
                                    + Add new account
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="kanso-form-label" for="owner">Owner <span style="color:var(--danger)">*</span></label>
                            <select class="kanso-select" id="owner" name="owner" required>
                                <option value="">Select owner…</option>
                                {% for owner in owners %}
                                <option value="{{ owner }}">{{ owner }}</option>
                                {% endfor %}
                            </select>
                            <div class="kanso-form-hint">
                                <button type="button"
                                        class="btn-kanso btn-kanso-ghost btn-kanso-sm"
                                        data-action="add-owner"
                                        style="margin-top:4px; font-size:12px; padding:3px 9px;">
                                    + Add new owner
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Credit Purchase -->
                <div class="kanso-card" style="margin-bottom:24px; padding:20px 22px;">
                    <div class="kanso-form-section">Credit Purchase</div>
                    <div style="display:flex; align-items:flex-start; gap:12px;">
                        <div style="flex-shrink:0; margin-top:2px;">
                            <input type="checkbox"
                                   id="is_credit"
                                   name="is_credit"
                                   style="width:18px; height:18px; accent-color:var(--primary); cursor:pointer;"
                                   onchange="handleCreditToggle()">
                        </div>
                        <div>
                            <label for="is_credit" style="font-size:13.5px; font-weight:600; color:var(--text); cursor:pointer; margin:0;">
                                This is a credit purchase
                            </label>
                            <div class="kanso-form-hint" style="margin-top:3px;">
                                Check this if buying on credit — adds to your debt balance, won't count as a monthly expense until paid.
                            </div>
                        </div>
                    </div>
                    <div id="creditWarning" class="kanso-note-box" style="display:none; margin-top:12px;">
                        <strong>Credit Purchase:</strong> This transaction will be added to your debt account's charges
                        and will NOT appear in your regular transaction list.
                    </div>
                </div>

                <!-- Actions -->
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <a href="{{ url_for('transactions.list_transactions') }}" class="btn-kanso btn-kanso-ghost">
                        Cancel
                    </a>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <button type="reset" class="btn-kanso btn-kanso-ghost">
                            Reset
                        </button>
                        <button type="submit" class="btn-kanso btn-kanso-ghost" onclick="setSaveAndAddAnother()">
                            Save &amp; Add Another
                        </button>
                        <button type="submit" class="btn-kanso btn-kanso-primary">
                            Save Transaction
                        </button>
                    </div>
                </div>

            </form>
        </div>

        <!-- ── Sidebar ── -->
        <div class="col-md-4">

            <!-- Quick Actions -->
            <div class="kanso-card" style="padding:18px 20px; margin-bottom:16px;">
                <div class="kanso-form-section" style="margin-bottom:12px;">Quick Actions</div>
                <div id="quickActionsContainer" style="display:grid; gap:8px;">
                    <div style="font-size:13px; color:var(--text-faint); text-align:center; padding:8px 0;">Loading quick actions…</div>
                </div>
                <div style="margin-top:12px; font-size:12px; color:var(--text-faint); line-height:1.5;">
                    Click any button to pre-fill the form with popular patterns.
                </div>
            </div>

            <!-- Tips -->
            <div class="kanso-card" style="padding:18px 20px;">
                <div class="kanso-form-section" style="margin-bottom:12px;">Tips</div>
                <ul style="margin:0 0 14px; padding-left:16px; font-size:12.5px; color:var(--text-muted); line-height:1.9;">
                    <li><strong style="color:var(--text);">Amount:</strong>
                        <ul style="margin:2px 0 0; padding-left:14px;">
                            <li><span style="color:var(--danger);">Positive (+)</span> — Expenses, purchases</li>
                            <li><span style="color:var(--success);">Negative (−)</span> — Income, refunds</li>
                        </ul>
                    </li>
                    <li><strong style="color:var(--text);">Description:</strong> Be specific for better tracking</li>
                    <li><strong style="color:var(--text);">Categories:</strong> Reuse existing ones for consistency</li>
                    <li><strong style="color:var(--text);">Business:</strong> Use credit toggle for Girasoul expenses</li>
                </ul>
                <div style="display:grid; gap:8px;">
                    <button class="btn-kanso btn-kanso-ghost" data-template="income">
                        Add Income / Refund
                    </button>
                    <button class="btn-kanso btn-kanso-ghost" data-template="business-income">
                        Add Girasoul Revenue
                    </button>
                </div>
            </div>

        </div>

    </div><!-- /row -->
</div><!-- /kanso-page-wide -->
{% endblock %}
